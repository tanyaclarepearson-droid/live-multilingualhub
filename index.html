<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multilingual Learning Hub — Live</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <main id="stage" aria-label="Hub stage">
    <img id="bg" src="/public/bg-room.webp" alt="" />
    <div id="overlays"></div>
  </main>
  <section id="demo-content" style="max-width: 760px; margin: 24px auto; background: rgba(255,255,255,.85); padding: 16px 18px; border-radius: 12px;">
  <h1>Sample Reading Block</h1>
  <p>
    This is a short paragraph to try the Readability controls: increase/decrease text size, toggle
    line spacing, high contrast, and a dyslexia-friendly font. These settings persist on each device.
  </p>
  <ul>
    <li>Try <strong>A+</strong> and <strong>A−</strong></li>
    <li>Toggle <strong>↕︎</strong> for line spacing</li>
    <li>Toggle <strong>HC</strong> for high contrast</li>
    <li>Toggle <strong>DF</strong> for dyslexia-friendly font</li>
  </ul>
</section>

<div id="readability-widget" aria-label="Readability controls">
  <button data-action="decrease" title="Decrease text size" aria-label="Decrease text size">A−</button>
  <button data-action="increase" title="Increase text size" aria-label="Increase text size">A+</button>
  <button data-action="spacing"  title="Toggle comfortable line spacing" aria-label="Toggle line spacing">↕︎</button>
  <button data-action="contrast" title="Toggle high contrast mode" aria-label="Toggle high contrast">HC</button>
  <button data-action="dyslexic" title="Toggle dyslexia-friendly font" aria-label="Dyslexia-friendly font">DF</button>
  <button data-action="reset"    title="Reset readability settings" aria-label="Reset">Reset</button>
</div>
<!-- ===== Adapt Text Tool (Step 1–3 skeleton) ===== -->
<section id="adapt-tool" aria-label="Adapt texts for students" style="max-width:980px;margin:24px auto;">
  <h2 style="margin:0 0 12px;">Adapt texts in 3 steps</h2>

  <!-- Step 1: Upload or Paste -->
  <div class="card">
    <h3>1) Upload or Paste</h3>
    <p class="muted">Upload a DOCX/PDF/TXT (≤15MB) or paste text directly.</p>
    <div class="row">
      <label class="file">
        <input id="at-file" type="file" accept=".txt,.pdf,.doc,.docx" />
        <span>Choose file…</span>
      </label>
      <button id="at-clear" type="button">Clear</button>
    </div>
    <textarea id="at-input" rows="8" placeholder="Paste your text here…"></textarea>
  </div>

  <!-- Step 2: Choose options -->
  <div class="card">
    <h3>2) Choose options</h3>
    <div class="row">
      <label>Target level:
        <select id="at-level">
          <option value="L1">L1 (easiest)</option>
          <option value="L2" selected>L2</option>
          <option value="L3">L3</option>
          <option value="L4">L4 (original-ish)</option>
        </select>
      </label>

      <label><input id="at-frames" type="checkbox" /> Sentence frames</label>
      <label><input id="at-glossary" type="checkbox" /> Glossary (top 5 words)</label>
      <label><input id="at-questions" type="checkbox" /> Comprehension Qs</label>
    </div>
    <button id="at-run" type="button">Generate adapted version</button>
  </div>

  <!-- Step 3: Preview & Download -->
  <div class="card">
    <h3>3) Preview & Download</h3>
    <div id="at-preview" class="preview" aria-live="polite">Your adapted text will appear here.</div>
    <div class="row">
      <button id="at-download" type="button" disabled>Download (.txt)</button>
    </div>
  </div>
</section>
<!-- ===== /Adapt Text Tool ===== -->

<!-- Deploy-aware loader: uses this Netlify deploy's ETag as a cache-busting token -->
<script type="module">
  // Get a stable version per deploy (ETag changes on each Netlify deploy)
  async function getDeployVersion() {
    try {
      const res = await fetch(window.location.pathname || '/', {
        method: 'HEAD',
        cache: 'no-store'
      });
      return res.headers.get('etag') || res.headers.get('x-nf-request-id') || String(Date.now());
    } catch {
      return String(Date.now());
    }
  }

  // Optionally refresh CSS with the same version (so each deploy invalidates the file)
  function refreshCSS(version) {
    const link = document.querySelector('link[rel="stylesheet"][href^="css/styles.css"]');
    if (!link) return;
    const url = new URL(link.getAttribute('href'), location.origin);
    url.searchParams.set('v', version);
    link.href = url.pathname + '?' + url.searchParams.toString();
  }

  (async () => {
    const v = await getDeployVersion();

    // Make sure CSS is aligned with this deploy
    refreshCSS(v);

    // Load app modules with the deploy version
    const [{ fitOverlays }, { mountHotspots }] = await Promise.all([
      import(`./js/app.js?v=${v}`),
      import(`./js/hotspots.js?v=${v}`)
    ]);

    // Fetch overlays JSON with the deploy version
    const spec = await fetch(`/data/overlays.json?v=${v}`, { cache: 'no-store' }).then(r => r.json());
    fitOverlays(spec);
    mountHotspots(spec);

    // Load readability (separate module) with same version
    import(`./js/readability.js?v=${v}`).then(m => {
      if (m?.initReadability) m.initReadability();
    });

    // Re-apply on resize as you had before
    addEventListener('resize', async () => {
      const spec2 = await fetch(`/data/overlays.json?v=${v}`, { cache: 'no-store' }).then(r => r.json());
      fitOverlays(spec2);
    });
  })();
</script>


</body>
</html>
